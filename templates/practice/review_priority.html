{% extends "base.html" %}
{% block title %}ğŸ“Œ æ™ºèƒ½æ¨è Â· é—å¿˜ä¼˜å…ˆæ’åº{% endblock %}
{% block content %}

<h2 class="mb-4">ğŸ“Œ é¢„æµ‹é—å¿˜ç‡ä¼˜å…ˆæ¨è</h2>

<!-- å›¾è¡¨åŒºåŸŸ -->
<h5>ğŸ“ˆ å½“å‰è®°å¿†ä¿æŒç‡å›¾ï¼ˆæŒ‰é¢„æµ‹é—å¿˜ç‡æ’åºï¼‰</h5>
<canvas id="retentionChart" height="300"></canvas>

<hr class="my-4">

<!-- è¡¨æ ¼åŒºåŸŸ -->
<h5>ğŸ“‹ æ¨èå¤ä¹ åˆ—è¡¨ï¼ˆæŒ‰æœ€å®¹æ˜“é—å¿˜æ’åºï¼‰</h5>
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>é¢˜ç›®</th>
      <th>ä¸Šæ¬¡ç»ƒä¹ </th>
      <th>é—´éš”å¤©æ•°</th>
      <th>æŒæ¡åº¦</th>
      <th>é—å¿˜ç‡</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.record.material.question_text|truncatechars:40 }}</td>
      <td>{{ item.record.answered_at|date:"Y-m-d" }}</td>
      <td>{{ item.days_since }} å¤©</td>
      <td>{{ item.record.ease|floatformat:2 }}</td>
      <td><span class="text-danger">{{ item.forgetting|floatformat:2 }}</span></td>
      <td>
        <a href="{% url 'retry_wrong' item.record.material.id %}?mode=typing" class="btn btn-sm btn-outline-primary">å†ç»ƒä¸€æ¬¡</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}

{% block extra_scripts %}
<!-- å¼•å…¥ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('retentionChart').getContext('2d');
  const retentionChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ labels|safe }},
      datasets: [{
        label: 'å½“å‰è®°å¿†ä¿æŒç‡ï¼ˆ%ï¼‰',
        data: {{ retention_data|safe }},
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      scales: {
        x: {
          beginAtZero: true,
          max: 100,
          title: {
            display: true,
            text: 'è®°å¿†ä¿æŒç‡ï¼ˆ%ï¼‰'
          }
        }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
</script>
{% endblock %}
